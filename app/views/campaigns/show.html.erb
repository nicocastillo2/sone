<div class="page-header">
  <%= link_to campaigns_path, class: 'btn btn-default' do %>
    <span class="glyphicon glyphicon-list-alt"></span>
    Regresar
  <% end %>
  <%= link_to edit_campaign_path(@campaign), class: 'btn btn-primary' do %>
    <span class="glyphicon glyphicon-pencil"></span>
    Editar
  <% end %>
  <h1>Campaña: <%= @campaign.name %></h1>
</div>

<dl class="dl-horizontal">
  <dt>Nombre:</dt>
  <dd><%= @campaign.name %></dd>

  <dt>Nombre del Remitente:</dt>
  <dd><%= @campaign.sender_name %></dd>

  <dt>Email del Remitente:</dt>
  <dd><%= @campaign.sender_email %></dd>

  <dt>Logo:</dt>
  <dd><%= image_tag(@campaign.logo_url.to_s) %></dd>

  <dt>Color:</dt>
  <dd><%= @campaign.color %></dd>

</dl>

<div id="nps_score"></div>
<%= javascript_tag do %>
  <%=
    graph_generate(
      'nps_score',
      data: {
        x: 'x',
        columns: [
          ['x'] + @nps.dates,
          ['NPS'] + @nps.nps,
          ['Detractors'] + @nps.detractors,
          ['Passives'] + @nps.passives,
          ['Promoters'] + @nps.promoters
        ],
        axes: {
          'NPS' => 'y',
          'Detractors' => 'y2',
          'Passives' => 'y2',
          'Promoters' => 'y2'
        }
      },
      axis: {
        x: {
          type: 'category'
        },
        y2: {
          show: true
        }
      }
    )
  %>
<% end %>

<h1>Contactos de la campañas</h1>

<%= link_to 'Enviar campaña', send_campaign_path(campaign_id: @campaign.id, sender_email: @campaign.sender_email), controller: 'campaigns', action: 'generate_campaign_mailing', class: 'btn btn-primary', remote: true, data: { confirm: 'Deseas enviar la campaña?'} %>
<br>
<br>

<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Estatus</th>
        <th>Fecha de envío</th>
        <th>Puntuación</th>
        <th>Comentario</th>
      </tr>
    </thead>

    <tbody>
      <% @campaign.contacts.each do |contact| %>
        <tr>
          <td><%= contact.name %></td>
          <td><%= contact.email %></td>
          <td><%= contact.status %></td>
          <td><%= contact.sent_date.to_s %></td>
          <td><%= contact.answer&.score %></td>
          <td><%= contact.answer&.comment %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
