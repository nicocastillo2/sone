<% provide(:header, "hidden")  %>
<div class="row">
  <div class="col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1">
    <div class="page-header">
      <div class="row">
        <div class="col-md-4">
          <h1 class="border-left"><%= @campaign.name %></h1>
        </div>
        <div class="col-md-4 col-md-offset-4 col-xs-4 col-xs-offset-1">
          <%= link_to campaigns_path, class: 'btn btn-default pink-button' do %>
            Regresar
          <% end %>
          <%= link_to edit_campaign_path(@campaign), class: 'btn btn-default pink-button' do %>
            Editar
            <span class="glyphicon glyphicon-pencil"></span>
          <% end %>
          </div>
        </div>
        
      
    </div>
    
   

    <div class="row margin-bot">
      <div class="col-md-3 align-center">
        <%= image_tag(@campaign.logo_url.to_s, class: "logo") %>
      </div>
      <div class="col-md-3 align-center">
        <p class="text-pink">Nombre:</p>    
        <p class="text-gray"><%= @campaign.name %></p>
      </div>
      <div class="col-md-3 align-center">
        <p class="text-pink">Email del Remitente:</p>
        <p class="text-gray"><%= @campaign.sender_email %></p>
      </div>
      <div class="col-md-3 align-center">
        <p class="text-pink">Email del Remitente:</p>
        <p class="text-gray"><%= @campaign.sender_email %></p>
      </div>
    </div>

    <div id="nps_score" class="shadow-box"></div>
    <%= javascript_tag do %>
      <%=
        graph_generate(
          'nps_score',
          data: {
            x: 'x',
            columns: [
              ['x'] + @nps.dates,
              ['NPS'] + @nps.nps,
              ['Detractors'] + @nps.detractors,
              ['Passives'] + @nps.passives,
              ['Promoters'] + @nps.promoters
            ],
            axes: {
              'NPS' => 'y',
              'Detractors' => 'y2',
              'Passives' => 'y2',
              'Promoters' => 'y2'
            }
          },
          axis: {
            x: {
              type: 'category'
            },
            y2: {
              show: true
            }
          }
        )
      %>
    <% end %>

    <h1 class="border-left" id="contactos">Contactos de la campañas</h1>

    <%= link_to 'Enviar campaña', send_campaign_path(campaign_id: @campaign.id, sender_email: @campaign.sender_email), controller: 'campaigns', action: 'generate_campaign_mailing', class: 'btn btn-default send-button', remote: true, data: { confirm: 'Deseas enviar la campaña?'} %>
    <br>
    <br>

    <div class="table-responsive shadow-box">
      <table class="table table-striped table-bordered table-hover ">
        <thead>
          <tr>
            <th class="back-gray">Nombre</th>
            <th class="back-gray">Email</th>
            <th class="back-gray">Estatus</th>
            <th class="back-gray">Fecha de envío</th>
            <th class="back-gray">Puntuación</th>
            <th class="back-gray">Comentario</th>
          </tr>
        </thead>

        <tbody>
          <% @contacts.each do |contact| %>
            <tr>
              <td><%= contact.name %></td>
              <td><%= contact.email %></td>
              <td  class="status"><%= contact.status %></td>
              <td class="sent_date"><%= contact.sent_date&.strftime "%d/%m/%Y".to_s %></td>
              <td class="score"><%= contact.answer ? contact.answer.score : "Pendiente" %></td>
              <td><%= contact.answer&.comment %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-md-1"></div>
</div>

<%= will_paginate @contacts %>
